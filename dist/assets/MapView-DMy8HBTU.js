import{r,j as o}from"./index-D2QpqqCf.js";import{L as M}from"./maps-93e-Jyro.js";import"./vendor-Bzgz95E1.js";import"./firebase-BnRZRRKd.js";const I="AIzaSyAylaaHTNErQ5xi0wXs0IHtTPunSKOvAHg",_=()=>o.jsx("div",{className:"map-loader",children:o.jsx("div",{className:"loading-spinner"})}),L=({message:p})=>o.jsx("div",{className:"map-error-overlay",children:o.jsx("p",{children:p})}),N=({onStartAudit:p})=>{const[f,P]=r.useState(!1),[y,b]=r.useState(null),[S,g]=r.useState(!0),h=r.useRef(null),c=r.useRef(null),a=r.useRef(null),w=r.useRef(null),s=r.useRef(null),d=r.useRef([]);r.useEffect(()=>{if(f)return;if(I.includes("your_google_maps_api_key_here")){b("Google Maps API key is not configured. Please set VITE_GOOGLE_MAPS_API_KEY in your environment.");return}new M({apiKey:I,version:"weekly",libraries:["places","marker"]}).load().then(t=>{P(!0),x(t)}).catch(t=>{console.error("Failed to load Google Maps script:",t),b("Failed to load Google Maps. Please check that the API key is correct and has the 'Maps JavaScript API' and 'Places API' enabled.")}).finally(()=>{g(!1)})},[f]);const x=n=>{if(!h.current||!c.current)return;a.current=new n.maps.Map(h.current,{center:{lat:34.0522,lng:-118.2437},zoom:12,mapId:"SMART_LOCAL_AI_MAP"}),w.current=new n.maps.places.PlacesService(a.current),s.current=new n.maps.InfoWindow;const t=new n.maps.places.Autocomplete(c.current,{fields:["geometry","name","website"]});t.addListener("place_changed",()=>{const e=t.getPlace();e.geometry&&e.geometry.location?(a.current?.setCenter(e.geometry.location),a.current?.setZoom(14),v({query:c.current?.value||e.name||""})):v({query:c.current.value})}),s.current.addListener("domready",()=>{const e=document.querySelector(".map-infowindow-content");!e||e.classList.contains("click-handler-attached")||(e.classList.add("click-handler-attached"),e.addEventListener("click",i=>{const l=i.target.closest(".btn-start-audit");if(l){const u=l.getAttribute("data-name"),m=l.getAttribute("data-website");u&&(p({name:decodeURIComponent(u),website:m?decodeURIComponent(m):void 0}),s.current?.close());return}}))})},v=n=>{w.current&&(n.location||(n.location=a.current.getCenter()),g(!0),w.current.textSearch(n,(t,e)=>{g(!1),e===google.maps.places.PlacesServiceStatus.OK&&t?R(t):console.warn("Places search failed with status:",e)}))},R=n=>{d.current.forEach(e=>e.setMap(null)),d.current=[];const t=new google.maps.LatLngBounds;n.forEach(e=>{if(!e.geometry||!e.geometry.location||!e.name)return;const i=new google.maps.Marker({map:a.current,position:e.geometry.location,title:e.name,animation:google.maps.Animation.DROP,icon:"https://maps.google.com/mapfiles/ms/icons/green-dot.png"});i.addListener("click",()=>{if(!s.current)return;const A=e.website??"",l=encodeURIComponent(e.name),u=encodeURIComponent(A),m=`
                    <div class="map-infowindow-content">
                        <h4>${e.name}</h4>
                        <p>${e.formatted_address||""}</p>
                        <div class="map-infowindow-buttons" style="margin-top: 1rem;">
                            <button class="btn btn-primary btn-start-audit" data-name="${l}" data-website="${u}">Start an audit</button>
                        </div>
                    </div>
                `;s.current.setContent(m),s.current.open(a.current,i)}),d.current.push(i),t.extend(e.geometry.location)}),a.current&&d.current.length>0&&a.current.fitBounds(t)};return o.jsxs("div",{className:"map-view-wrapper",children:[y&&o.jsx(L,{message:y}),S&&o.jsx(_,{}),o.jsx("input",{ref:c,type:"text",className:"map-search-input",placeholder:"Search for a business or location",disabled:!f}),o.jsx("div",{ref:h,className:"map-container"})]})};export{N as MapView};
